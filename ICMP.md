# Wireshark Lab: ICMP v8.0

## Overview

The goal with this [ICMP Wireshark lab](https://www-net.cs.umass.edu/wireshark-labs/Wireshark_ICMP_v8.0.pdf) is to explore several aspects of the **ICMP (Internet Control Message Protocol)**:
- ICMP messages generated by the **Ping** program.
- ICMP messages generated by the **Traceroute** program.
- The format and contents of an **ICMP message**.

---

## Part 1: ICMP and Ping
The **Ping** program is a tool used to verify if a host is live by sending a packet to a target IP address and receiving a response if the target is active. Both the query and response packets are **ICMP packets**.

### Steps
1. Open the **Terminal**.
2. Start **Wireshark** and begin packet capture.
3. Run the `ping -c 10 [hostname]` command:
- Replace `hostname` with a host on another continent (e.g., `www.ust.hk` for Hong Kong University of Science and Technology if outside Asia).

       ping -c 10 www.ust.hk

- The `-c` option specifies the number of packets to send, in this case 10 packets.

4. When the Ping program terminates, stop Wireshark packet capture.

### Expected Output
- The **Terminal** will show:
  - 10 query packets sent and 10 responses received.
  - Round-trip time (RTT) across all responses.
- **Wireshark** output will show:
  - 20 packets: 10 Ping queries and 10 Ping responses.
  - Source IP address (e.g., private address like `192.168.x.x` behind a NAT).
  - Destination IP address (e.g., the Hong Kong server).
  - IP datagram with protocol number `01` (indicating ICMP payload).
- The expanded ICMP packet:
  - Type 8, Code 0 (ICMP “echo request”).
  - Contains fields: checksum, identifier, and sequence number.

### Deliverables
- Submit a screenshot of the **Terminal** window (similar to **Figure 1**).
- For each question below, provide a printout of the relevant packet(s) from the Wireshark trace:
  - Use **File > Print**, select **Selected packet only**, choose **Packet summary line**, and include minimal packet details.
  - **Annotate** the printout (highlight and add explanatory text, preferably in a colored pen for paper submissions or digitally for electronic submissions).

### Questions
1. What is the IP address of your host? What is the IP address of the destination host?
2. Why does an ICMP packet lack source and destination port numbers?
3. Examine a ping request packet sent by your host:
   - What are the ICMP type and code numbers?
   - What other fields are present?
   - How many bytes are the checksum, sequence number, and identifier fields?
4. Examine the corresponding ping reply packet:
   - What are the ICMP type and code numbers?
   - What other fields are present?
   - How many bytes are the checksum, sequence number, and identifier fields?

**Note**: If unable to run Wireshark live, download the trace file `ICMP-ethereal-trace-1` from [http://gaia.cs.umass.edu/wireshark-labs/wireshark-traces.zip](http://gaia.cs.umass.edu/wireshark-labs/wireshark-traces.zip), load it into Wireshark, and use it to answer the questions.

---

## Part 2: ICMP and Traceroute
The **Traceroute** program traces the path a packet takes from source to destination, as discussed in **Sections 1.4 and 5.6** of the textbook. In Windows, Traceroute (called `tracert`) uses **ICMP packets**, unlike Unix/Linux, which uses **UDP packets**.

### Steps
1. Open the **Windows Command Prompt** (found in the Accessories folder).
2. Start **Wireshark** and begin packet capture.
3. Run the **Traceroute** command:
   - Command: `tracert hostname` or `c:\windows\system32\tracert hostname`
   - Replace `hostname` with a host on another continent (e.g., `www.inria.fr` for INRIA in France if outside Europe).
   - Press **Enter** to execute.
4. When the Traceroute program terminates, stop Wireshark packet capture.

### Notes
- Windows uses `tracert` (not `traceroute`).
- A shareware alternative, **PingPlotter** ([www.pingplotter.com](http://www.pingplotter.com)), is recommended for the Wireshark IP lab due to additional functionality.
- Traceroute sends ICMP packets with increasing TTL values (TTL=1, 2, 3, ...). When a packet’s TTL reaches 1 at a router, the router sends an **ICMP TTL-exceeded** error packet back to the source.

### Expected Output
- The **Command Prompt** will resemble **Figure 4**, showing:
  - For each TTL value, three probe packets are sent.
  - RTTs for each probe and the IP address (possibly name) of the router returning the ICMP TTL-exceeded message.
- **Wireshark** output (as in **Figure 5**) shows an ICMP error packet with more fields than Ping ICMP messages.

### Deliverables
- Submit a screenshot of the **Command Prompt** window (similar to **Figure 4**).
- For each question below, provide a printout of the relevant packet(s) from the Wireshark trace:
  - Use **File > Print**, select **Selected packet only**, choose **Packet summary line**, and include minimal packet details.
  - **Annotate** the printout to explain your answer.

### Questions
5. What is the IP address of your host? What is the IP address of the target destination host?
6. If ICMP sent UDP packets (as in Unix/Linux), would the IP protocol number still be `01` for the probe packets? If not, what would it be?
7. Examine the ICMP echo packet in your screenshot. Is it different from the ICMP ping query packets in Part 1? If yes, how so?
8. Examine the ICMP error packet in your screenshot. What additional fields does it have compared to the ICMP echo packet?
9. Examine the last three ICMP packets received by the source host. How are they different from the ICMP error packets? Why are they different?
10. Within the `tracert` measurements, is there a link with significantly longer delay than others? Refer to **Figure 4**—is there such a link? Based on router names, can you guess the location of the two routers at the ends of this link?

**Note**: If unable to run Wireshark live, download the trace file `ICMP-ethereal-trace-2` from [http://gaia.cs.umass.edu/wireshark-labs/wireshark-traces.zip](http://gaia.cs.umass.edu/wireshark-labs/wireshark-traces.zip), load it into Wireshark, and use it to answer the questions.

---

## Part 3: Extra Credit
For a previous programming assignment, you created a **UDP client ping program** that sends **UDP probe packets** (unlike the standard ICMP-based ping).

### Task
- Use your UDP client ping program to send a UDP packet with an **unusual destination port number** to a live host.
- Simultaneously, use **Wireshark** to capture any response from the target host.

### Deliverables
- Provide a **Wireshark screenshot** of the response.
- Include an **analysis** of the response.

---

## General Notes
- **References**: All figure and section references are to *Computer Networking: A Top-Down Approach, 8th ed.*, J.F. Kurose and K.W. Ross, Addison-Wesley/Pearson, 2020.
- **Annotation**: Highlight the relevant part of the packet printout and add explanatory text (use a colored pen for paper submissions or digital annotations for electronic submissions).
- **Trace Files**: If live capture is not possible, use the provided trace files (`ICMP-ethereal-trace-1` for Ping, `ICMP-ethereal-trace-2` for Traceroute) from [http://gaia.cs.umass.edu/wireshark-labs/wireshark-traces.zip](http://gaia.cs.umass.edu/wireshark-labs/wireshark-traces.zip).
