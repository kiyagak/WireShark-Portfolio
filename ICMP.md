# Wireshark Lab: ICMP

## Objective

In this [ICMP Wireshark lab](https://www-net.cs.umass.edu/wireshark-labs/Wireshark_ICMP_v8.0.pdf) I will use Microsoft Windows to explore the **ICMP protocol** through:
- ICMP messages generated by **Ping**
- ICMP messages generated by **Traceroute**
- Format and contents of **ICMP messages**

---

## Part 1: ICMP and Ping

### Instructions
1. Open **Windows Command Prompt**.
2. Start **Wireshark** and begin packet capture.
3. Run the Ping command:  
```cmd
ping -n 10 hostname
```  

- Use a host on **another continent** (e.g., `www.ust.hk` if outside Asia).

```cmd
ping -n 10 www.ust.hk
```  

- `-n 10` → sends 10 ping messages.
4. Press **Enter** to execute.
5. When Ping terminates, **stop Wireshark capture**.

```
ping -n 10 www.ust.hk

Pinging www.ust.hk [143.89.209.9] with 32 bytes of data:
Reply from 143.89.209.9: bytes=32 time=238ms TTL=36
Reply from 143.89.209.9: bytes=32 time=239ms TTL=36
Reply from 143.89.209.9: bytes=32 time=239ms TTL=36
Reply from 143.89.209.9: bytes=32 time=239ms TTL=36
Reply from 143.89.209.9: bytes=32 time=249ms TTL=36
Reply from 143.89.209.9: bytes=32 time=239ms TTL=36
Reply from 143.89.209.9: bytes=32 time=239ms TTL=36
Reply from 143.89.209.9: bytes=32 time=239ms TTL=36
Reply from 143.89.209.9: bytes=32 time=239ms TTL=36
Reply from 143.89.209.9: bytes=32 time=242ms TTL=36

Ping statistics for 143.89.209.9:
    Packets: Sent = 10, Received = 10, Lost = 0 (0% loss),
Approximate round trip times in milli-seconds:
    Minimum = 238ms, Maximum = 249ms, Average = 240ms
```

---

### Questions to Answer

| # | Question |
|---|----------|
| 1 | What is the **IP address of your host**? What is the **IP address of the destination host**? |
| 2 | Why does an **ICMP packet have no source or destination port numbers**? |
| 3 | Examine a **Ping request packet**:<br>  • ICMP **Type** and **Code**?<br>  • Other fields?<br>  • Size (bytes) of **checksum**, **sequence number**, and **identifier**? |
| 4 | Examine the **corresponding Ping reply**:<br>  • ICMP **Type** and **Code**?<br>  • Other fields?<br>  • Size (bytes) of **checksum**, **sequence number**, and **identifier**? |

- Host IP address: `10.98.0.3`
- Destination IP address: `143.89.209.9`
- ICMP doesn't use source or destination ports because it is a layer 3 protocol.  Ports are a Layer 4 feature used by TCP and UDP to identify applications.
- ICMP type: Echo (ping) request (8)

		Type: Echo (ping) request (8)

- ICMP code: 0

		Code: 0

- Other fields:

```
1	0.000000	10.98.0.3	128.93.162.83	ICMP	92	Echo (ping) request  id=0x0001, seq=71/18176, ttl=1 (no response found!)

Internet Control Message Protocol
    Checksum: 0xf7b7 [correct]
    [Checksum Status: Good]
    Identifier (BE): 1 (0x0001)
    Identifier (LE): 256 (0x0100)
    Sequence Number (BE): 71 (0x0047)
    Sequence Number (LE): 18176 (0x4700)
    [No response seen]
    Data (64 bytes)
```

<img width="1063" height="486" alt="image" src="https://github.com/user-attachments/assets/4433b7dd-7dc7-40ec-a6f3-292b3a97f233" />

```
6	5.863306	10.98.0.3	143.89.209.9	ICMP	60	Echo (ping) request  id=0x0001, seq=31/7936, ttl=128 (reply in 7)
7	6.102053	143.89.209.9	10.98.0.3	ICMP	60	Echo (ping) reply    id=0x0001, seq=31/7936, ttl=36 (request in 6)
8	6.868209	10.98.0.3	143.89.209.9	ICMP	60	Echo (ping) request  id=0x0001, seq=32/8192, ttl=128 (reply in 9)
9	7.107432	143.89.209.9	10.98.0.3	ICMP	60	Echo (ping) reply    id=0x0001, seq=32/8192, ttl=36 (request in 8)
10	7.872244	10.98.0.3	143.89.209.9	ICMP	60	Echo (ping) request  id=0x0001, seq=33/8448, ttl=128 (reply in 11)
11	8.111373	143.89.209.9	10.98.0.3	ICMP	60	Echo (ping) reply    id=0x0001, seq=33/8448, ttl=36 (request in 10)
12	8.876076	10.98.0.3	143.89.209.9	ICMP	60	Echo (ping) request  id=0x0001, seq=34/8704, ttl=128 (reply in 13)
13	9.115057	143.89.209.9	10.98.0.3	ICMP	60	Echo (ping) reply    id=0x0001, seq=34/8704, ttl=36 (request in 12)
14	9.879613	10.98.0.3	143.89.209.9	ICMP	60	Echo (ping) request  id=0x0001, seq=35/8960, ttl=128 (reply in 15)
15	10.128566	143.89.209.9	10.98.0.3	ICMP	60	Echo (ping) reply    id=0x0001, seq=35/8960, ttl=36 (request in 14)
16	10.884715	10.98.0.3	143.89.209.9	ICMP	60	Echo (ping) request  id=0x0001, seq=36/9216, ttl=128 (reply in 17)
17	11.123888	143.89.209.9	10.98.0.3	ICMP	60	Echo (ping) reply    id=0x0001, seq=36/9216, ttl=36 (request in 16)
18	11.888296	10.98.0.3	143.89.209.9	ICMP	60	Echo (ping) request  id=0x0001, seq=37/9472, ttl=128 (reply in 19)
19	12.127259	143.89.209.9	10.98.0.3	ICMP	60	Echo (ping) reply    id=0x0001, seq=37/9472, ttl=36 (request in 18)
20	12.892389	10.98.0.3	143.89.209.9	ICMP	60	Echo (ping) request  id=0x0001, seq=38/9728, ttl=128 (reply in 21)
21	13.132055	143.89.209.9	10.98.0.3	ICMP	60	Echo (ping) reply    id=0x0001, seq=38/9728, ttl=36 (request in 20)
22	13.896425	10.98.0.3	143.89.209.9	ICMP	60	Echo (ping) request  id=0x0001, seq=39/9984, ttl=128 (reply in 23)
23	14.135413	143.89.209.9	10.98.0.3	ICMP	60	Echo (ping) reply    id=0x0001, seq=39/9984, ttl=36 (request in 22)
24	14.900055	10.98.0.3	143.89.209.9	ICMP	60	Echo (ping) request  id=0x0001, seq=40/10240, ttl=128 (reply in 25)
25	15.142552	143.89.209.9	10.98.0.3	ICMP	60	Echo (ping) reply    id=0x0001, seq=40/10240, ttl=36 (request in 24)
```

<img width="1063" height="664" alt="image" src="https://github.com/user-attachments/assets/10e422a6-7121-4b99-9a33-fd255f4e1149" />

- Host IP address: `10.98.0.3`
- Destination IP address: `143.89.209.9`
- ICMP doesn't use source or destination ports because it is a layer 3 protocol.  Ports are a Layer 4 feature used by TCP and UDP to identify applications.
- ICMP type: `Echo (ping) request (8)`

      Type: Echo (ping) request (8)

- ICMP code: `0`
- Other fields:

```
6	5.863306	10.98.0.3	143.89.209.9	ICMP	60	Echo (ping) request  id=0x0001, seq=31/7936, ttl=128 (reply in 7)

Internet Control Message Protocol
    Checksum: 0x4d3c [correct]
    [Checksum Status: Good]
    Identifier (BE): 1 (0x0001)
    Identifier (LE): 256 (0x0100)
    Sequence Number (BE): 31 (0x001f)
    Sequence Number (LE): 7936 (0x1f00)
    [Response frame: 7]
    Data (32 bytes)
```

- Size (bytes) of **checksum**, **sequence number**, and **identifier**?
	- Checksum: 19,772 bytes after converting `0x4d3c` into decimal
	- Sequence number: 31 bytes
	- Identifier: 1 byte

---

## Part 2: ICMP and Traceroute

### Instructions
1. Open **Windows Command Prompt**.
2. Start **Wireshark** and begin packet capture.
3. Run the Traceroute command:  
```cmd
tracert hostname
```

- Use a host on **another continent** (e.g., `www.inria.fr` if outside Europe).

```cmd
tracert www.inria.fr
```
		
4. Press **Enter** to execute.
5. When Traceroute terminates, **stop Wireshark capture**.

---

### Questions to Answer

| #   | Question |
|-----|----------|
| 5   | What is the IP address of your host? What is the IP address of the target destination? |
| 6   | If ICMP sent UDP packets (like Unix/Linux), would the IP protocol number still be 01? If not, what would it be? |
| 7   | Examine an ICMP echo packet in Traceroute. Is it different from Ping query packets? How? |
| 8   | Examine an ICMP error packet. It has more fields than echo packets. What is included in those fields? |
| 9   | Examine the last three ICMP packets received. How are they different from ICMP error packets? Why? |
| 10  | In tracert output:<br>	• Is there a link with significantly higher delay?<br>	• Refer to Figure 4: Identify the high-delay link.<br>	• Using router names, guess the location of the two routers at its ends. |

### Answers

- Host IP address: `10.98.0.3`
- Destination IP address: `128.93.162.83`
- If ICMP sent UDP packets like Unix/Linux, the IP protocol number would not be `01`, it would be `17`.

```
1	0.000000	10.98.0.3	128.93.162.83	ICMP	92	Echo (ping) request  id=0x0001, seq=71/18176, ttl=1 (no response found!)

Internet Protocol Version 4, Src: 10.98.0.3, Dst: 128.93.162.83
    Protocol: ICMP (1)
```

Are Traceroute's ICMP echo packets different from Ping query packets?
- Yes.  

```
6	5.863306	10.98.0.3	143.89.209.9	ICMP	60	Echo (ping) request  id=0x0001, seq=31/7936, ttl=128 (reply in 7)
1	0.000000	10.98.0.3	128.93.162.83	ICMP	92	Echo (ping) request  id=0x0001, seq=71/18176, ttl=1 (no response found!)
```

How?
- The TTL value.  Traceroute changes the TTL, starting at 1 and increasing by 1 for each new set of probes so that it finds each hop along the route.

Examine an ICMP error packet.
- It has more fields than echo packets.
- What is included in those fields?

```
2	0.020643	10.98.0.1	10.98.0.3	ICMP	120	Time-to-live exceeded (Time to live exceeded in transit)

Internet Protocol Version 4, Src: 10.98.0.3, Dst: 128.93.162.83
    0100 .... = Version: 4
    .... 0101 = Header Length: 20 bytes (5)
    Differentiated Services Field: 0x00 (DSCP: CS0, ECN: Not-ECT)
    Total Length: 92
    Identification: 0x3fd1 (16337)
    000. .... = Flags: 0x0
    ...0 0000 0000 0000 = Fragment Offset: 0
    Time to Live: 1
    Protocol: ICMP (1)
    Header Checksum: 0x4cbb [validation disabled]
    [Header checksum status: Unverified]
    Source Address: 10.98.0.3
    Destination Address: 128.93.162.83
    [Stream index: 0]

```

Examine the last three ICMP packets received.

How are they different from ICMP error packets?
- They are ICMP echo (ping) requests and replies.  

```
66	10.701182	128.93.162.83	10.98.0.3	ICMP	92	Echo (ping) reply    id=0x0001, seq=99/25344, ttl=55 (request in 65)
67	10.702461	10.98.0.3	128.93.162.83	ICMP	92	Echo (ping) request  id=0x0001, seq=100/25600, ttl=10 (reply in 68)
68	10.795737	128.93.162.83	10.98.0.3	ICMP	92	Echo (ping) reply    id=0x0001, seq=100/25600, ttl=55 (request in 67)
```

Why?
- Because they were successful requests and replies that did not exceed the time-to-live (TTL) value.  

<img width="1063" height="664" alt="image" src="https://github.com/user-attachments/assets/363b32b7-e195-4aed-9d7d-0aa3bee3a3e1" />

In tracert output:
-  Is there a link with significantly higher delay?
	-  Yes.

What is the high-delay link?
- Hop 9 shows the round trip of the second probe taking `324` ms.  

| Hop Number | 1st Probe (ms) | 2nd Probe (ms) | 3rd Probe (ms) | Hostname and IP |
|------------|----------------|----------------|----------------|-----------------|
| **9**      | **93 ms**      | **324 ms**     | **93 ms**      | **unit240-reth1-vfw-ext-dc1.inria.fr [192.93.122.19]** |

```
tracert www.inria.fr

Tracing route to inria.fr [128.93.162.83]
over a maximum of 30 hops:

  9    93 ms   324 ms    93 ms  unit240-reth1-vfw-ext-dc1.inria.fr [192.93.122.19]
```

Using router names, guess the location of the two routers at the end of the link.
- It is located in France (FR).  

```
  9    93 ms   324 ms    93 ms  unit240-reth1-vfw-ext-dc1.inria.fr [192.93.122.19]
 10    93 ms    93 ms    93 ms  prod-inriafr-cms.inria.fr [128.93.162.83]
```

## Traceroute Wireshark Capture Packet List

```
1	0.000000	10.98.0.3	128.93.162.83	ICMP	92	Echo (ping) request  id=0x0001, seq=71/18176, ttl=1 (no response found!)
2	0.020643	10.98.0.1	10.98.0.3	ICMP	120	Time-to-live exceeded (Time to live exceeded in transit)
3	0.021606	10.98.0.3	128.93.162.83	ICMP	92	Echo (ping) request  id=0x0001, seq=72/18432, ttl=1 (no response found!)
4	0.042404	10.98.0.1	10.98.0.3	ICMP	120	Time-to-live exceeded (Time to live exceeded in transit)
5	0.043691	10.98.0.3	128.93.162.83	ICMP	92	Echo (ping) request  id=0x0001, seq=73/18688, ttl=1 (no response found!)
6	0.065023	10.98.0.1	10.98.0.3	ICMP	120	Time-to-live exceeded (Time to live exceeded in transit)
11	1.105158	10.98.0.3	128.93.162.83	ICMP	92	Echo (ping) request  id=0x0001, seq=74/18944, ttl=2 (no response found!)
12	1.125724	181.214.131.125	10.98.0.3	ICMP	120	Time-to-live exceeded (Time to live exceeded in transit)
13	1.126761	10.98.0.3	128.93.162.83	ICMP	92	Echo (ping) request  id=0x0001, seq=75/19200, ttl=2 (no response found!)
14	1.147393	181.214.131.125	10.98.0.3	ICMP	120	Time-to-live exceeded (Time to live exceeded in transit)
15	1.148431	10.98.0.3	128.93.162.83	ICMP	92	Echo (ping) request  id=0x0001, seq=76/19456, ttl=2 (no response found!)
16	1.168997	181.214.131.125	10.98.0.3	ICMP	120	Time-to-live exceeded (Time to live exceeded in transit)
21	2.189833	10.98.0.3	128.93.162.83	ICMP	92	Echo (ping) request  id=0x0001, seq=77/19712, ttl=3 (no response found!)
22	2.210608	79.127.195.57	10.98.0.3	ICMP	120	Time-to-live exceeded (Time to live exceeded in transit)
23	2.211771	10.98.0.3	128.93.162.83	ICMP	92	Echo (ping) request  id=0x0001, seq=78/19968, ttl=3 (no response found!)
24	2.232838	79.127.195.57	10.98.0.3	ICMP	120	Time-to-live exceeded (Time to live exceeded in transit)
25	2.235006	10.98.0.3	128.93.162.83	ICMP	92	Echo (ping) request  id=0x0001, seq=79/20224, ttl=3 (no response found!)
26	2.256350	79.127.195.57	10.98.0.3	ICMP	120	Time-to-live exceeded (Time to live exceeded in transit)
27	3.241830	10.98.0.3	128.93.162.83	ICMP	92	Echo (ping) request  id=0x0001, seq=80/20480, ttl=4 (no response found!)
28	3.263593	198.47.104.217	10.98.0.3	ICMP	56	Time-to-live exceeded (Time to live exceeded in transit)
29	3.265757	10.98.0.3	128.93.162.83	ICMP	92	Echo (ping) request  id=0x0001, seq=81/20736, ttl=4 (no response found!)
30	3.288623	198.47.104.217	10.98.0.3	ICMP	56	Time-to-live exceeded (Time to live exceeded in transit)
31	3.289760	10.98.0.3	128.93.162.83	ICMP	92	Echo (ping) request  id=0x0001, seq=82/20992, ttl=4 (no response found!)
32	3.311628	198.47.104.217	10.98.0.3	ICMP	56	Time-to-live exceeded (Time to live exceeded in transit)
33	4.297791	10.98.0.3	128.93.162.83	ICMP	92	Echo (ping) request  id=0x0001, seq=83/21248, ttl=5 (no response found!)
34	4.393517	213.200.120.85	10.98.0.3	ICMP	56	Time-to-live exceeded (Time to live exceeded in transit)
35	4.395485	10.98.0.3	128.93.162.83	ICMP	92	Echo (ping) request  id=0x0001, seq=84/21504, ttl=5 (no response found!)
36	4.487943	213.200.120.85	10.98.0.3	ICMP	56	Time-to-live exceeded (Time to live exceeded in transit)
37	4.490219	10.98.0.3	128.93.162.83	ICMP	92	Echo (ping) request  id=0x0001, seq=85/21760, ttl=5 (no response found!)
38	4.595330	213.200.120.85	10.98.0.3	ICMP	56	Time-to-live exceeded (Time to live exceeded in transit)
39	5.496605	10.98.0.3	128.93.162.83	ICMP	92	Echo (ping) request  id=0x0001, seq=86/22016, ttl=6 (no response found!)
40	5.588719	212.222.6.69	10.98.0.3	ICMP	56	Time-to-live exceeded (Time to live exceeded in transit)
41	5.591585	10.98.0.3	128.93.162.83	ICMP	92	Echo (ping) request  id=0x0001, seq=87/22272, ttl=6 (no response found!)
42	5.683611	212.222.6.69	10.98.0.3	ICMP	56	Time-to-live exceeded (Time to live exceeded in transit)
43	5.684755	10.98.0.3	128.93.162.83	ICMP	92	Echo (ping) request  id=0x0001, seq=88/22528, ttl=6 (no response found!)
44	5.776495	212.222.6.69	10.98.0.3	ICMP	56	Time-to-live exceeded (Time to live exceeded in transit)
45	6.691890	10.98.0.3	128.93.162.83	ICMP	92	Echo (ping) request  id=0x0001, seq=89/22784, ttl=7 (no response found!)
46	6.785557	193.51.180.131	10.98.0.3	ICMP	96	Time-to-live exceeded (Time to live exceeded in transit)
47	6.788348	10.98.0.3	128.93.162.83	ICMP	92	Echo (ping) request  id=0x0001, seq=90/23040, ttl=7 (no response found!)
48	6.881463	193.51.180.131	10.98.0.3	ICMP	96	Time-to-live exceeded (Time to live exceeded in transit)
49	6.884009	10.98.0.3	128.93.162.83	ICMP	92	Echo (ping) request  id=0x0001, seq=91/23296, ttl=7 (no response found!)
50	6.977403	193.51.180.131	10.98.0.3	ICMP	96	Time-to-live exceeded (Time to live exceeded in transit)
51	7.889388	10.98.0.3	128.93.162.83	ICMP	92	Echo (ping) request  id=0x0001, seq=92/23552, ttl=8 (no response found!)
52	7.982766	193.51.184.177	10.98.0.3	ICMP	56	Time-to-live exceeded (Time to live exceeded in transit)
53	7.985630	10.98.0.3	128.93.162.83	ICMP	92	Echo (ping) request  id=0x0001, seq=93/23808, ttl=8 (no response found!)
54	8.078881	193.51.184.177	10.98.0.3	ICMP	56	Time-to-live exceeded (Time to live exceeded in transit)
55	8.081261	10.98.0.3	128.93.162.83	ICMP	92	Echo (ping) request  id=0x0001, seq=94/24064, ttl=8 (no response found!)
56	8.174355	193.51.184.177	10.98.0.3	ICMP	56	Time-to-live exceeded (Time to live exceeded in transit)
57	9.086813	10.98.0.3	128.93.162.83	ICMP	92	Echo (ping) request  id=0x0001, seq=95/24320, ttl=9 (no response found!)
58	9.179991	192.93.122.19	10.98.0.3	ICMP	56	Time-to-live exceeded (Time to live exceeded in transit)
59	9.182651	10.98.0.3	128.93.162.83	ICMP	92	Echo (ping) request  id=0x0001, seq=96/24576, ttl=9 (no response found!)
60	9.506879	192.93.122.19	10.98.0.3	ICMP	56	Time-to-live exceeded (Time to live exceeded in transit)
61	9.508132	10.98.0.3	128.93.162.83	ICMP	92	Echo (ping) request  id=0x0001, seq=97/24832, ttl=9 (no response found!)
62	9.601486	192.93.122.19	10.98.0.3	ICMP	56	Time-to-live exceeded (Time to live exceeded in transit)
63	10.513866	10.98.0.3	128.93.162.83	ICMP	92	Echo (ping) request  id=0x0001, seq=98/25088, ttl=10 (reply in 64)
64	10.606977	128.93.162.83	10.98.0.3	ICMP	92	Echo (ping) reply    id=0x0001, seq=98/25088, ttl=55 (request in 63)
65	10.608126	10.98.0.3	128.93.162.83	ICMP	92	Echo (ping) request  id=0x0001, seq=99/25344, ttl=10 (reply in 66)
66	10.701182	128.93.162.83	10.98.0.3	ICMP	92	Echo (ping) reply    id=0x0001, seq=99/25344, ttl=55 (request in 65)
67	10.702461	10.98.0.3	128.93.162.83	ICMP	92	Echo (ping) request  id=0x0001, seq=100/25600, ttl=10 (reply in 68)
68	10.795737	128.93.162.83	10.98.0.3	ICMP	92	Echo (ping) reply    id=0x0001, seq=100/25600, ttl=55 (request in 67)
```

---

## What I Learned

I learned
- how to send a specific number of pings to a specific host
- to use Wireshark to find the source and destination IPs for the pings
- that ICMP doesn't need source or destination ports because it is a layer 3 protocol
- that ports are a Layer 4 feature used by TCP and UDP to identify applications
- ICMP pings and traceroutes both use `Type: Echo (ping) request (8)` and `Code: 0` in their fields
- the expected size (in bytes) of the checksum, sequence number, and identifier fields
- the difference between BE and LE, and to analyze the default BE field when both fields appear
- how to trace the path and round-trip time each hop takes to reach a host
- Traceroute can use ICMP to send UDP packets (like Unix/Linux) or ICMP packets to change the protocol number captured by Wireshark
- that Traceroute's ICMP echo packets different from Ping query packets based on the TTL value that is changed by Traceroute changes the TTL to find each hop along the route
- that ICMP error packets have more fields than ICMP echo packets
- Wireshark shows ICMP echo requests and replies for requests that don't exceed the TTL value
- The `tracert` command's 9th hop had the highest delay, with its 2nd probe's RTT taking `324` ms.  
- that the last two hop's locations are located in Rocquencourt, France, a city just outside of Paris, France
