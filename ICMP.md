# Wireshark Lab: ICMP

**Supplement to *Computer Networking: A Top-Down Approach*, 8th ed., J.F. Kurose & K.W. Ross**

---

## Objective

I will use Microsoft Windows to explore the **ICMP protocol** through:
- ICMP messages generated by **Ping**
- ICMP messages generated by **Traceroute**
- Format and contents of **ICMP messages**

---

## Part 1: ICMP and Ping

### Instructions
1. Open **Windows Command Prompt**.
2. Start **Wireshark** and begin packet capture.
3. Run the Ping command:  
```cmd
ping -n 10 hostname
```  

- Use a host on **another continent** (e.g., `www.ust.hk` if outside Asia).

```cmd
ping -n 10 www.ust.hk
```  

- `-n 10` → sends 10 ping messages.
4. Press **Enter** to execute.
5. When Ping terminates, **stop Wireshark capture**.

---

### Questions to Answer

| # | Question |
|---|----------|
| 1 | What is the **IP address of your host**? What is the **IP address of the destination host**? |
| 2 | Why does an **ICMP packet have no source or destination port numbers**? |
| 3 | Examine a **Ping request packet**:<br>  • ICMP **Type** and **Code*?<br>  • Other fields?<br>  • Size (bytes) of **checksum**, **sequence number**, and **identifier**? |
| 4 | Examine the **corresponding Ping reply**:<br>  • ICMP **Type** and **Code**?<br>  • Other fields?<br>  • Size (bytes) of **checksum**, **sequence number**, and **identifier**? |

- Host IP address: `10.98.0.3`
- Destination IP address: `143.89.209.9`
- ICMP doesn't use source or destination ports because it is a layer 3 protocol.  Ports are a Layer 4 feature used by TCP and UDP to identify applications.
- ICMP type: Echo (ping) request (8)

		Type: Echo (ping) request (8)

- ICMP code: 0

		Code: 0

- Other fields:

```
1	0.000000	10.98.0.3	128.93.162.83	ICMP	92	Echo (ping) request  id=0x0001, seq=71/18176, ttl=1 (no response found!)

Internet Control Message Protocol
    Checksum: 0xf7b7 [correct]
    [Checksum Status: Good]
    Identifier (BE): 1 (0x0001)
    Identifier (LE): 256 (0x0100)
    Sequence Number (BE): 71 (0x0047)
    Sequence Number (LE): 18176 (0x4700)
    [No response seen]
    Data (64 bytes)
```

<img width="1063" height="486" alt="image" src="https://github.com/user-attachments/assets/4433b7dd-7dc7-40ec-a6f3-292b3a97f233" />

```
6	5.863306	10.98.0.3	143.89.209.9	ICMP	60	Echo (ping) request  id=0x0001, seq=31/7936, ttl=128 (reply in 7)
7	6.102053	143.89.209.9	10.98.0.3	ICMP	60	Echo (ping) reply    id=0x0001, seq=31/7936, ttl=36 (request in 6)
8	6.868209	10.98.0.3	143.89.209.9	ICMP	60	Echo (ping) request  id=0x0001, seq=32/8192, ttl=128 (reply in 9)
9	7.107432	143.89.209.9	10.98.0.3	ICMP	60	Echo (ping) reply    id=0x0001, seq=32/8192, ttl=36 (request in 8)
10	7.872244	10.98.0.3	143.89.209.9	ICMP	60	Echo (ping) request  id=0x0001, seq=33/8448, ttl=128 (reply in 11)
11	8.111373	143.89.209.9	10.98.0.3	ICMP	60	Echo (ping) reply    id=0x0001, seq=33/8448, ttl=36 (request in 10)
12	8.876076	10.98.0.3	143.89.209.9	ICMP	60	Echo (ping) request  id=0x0001, seq=34/8704, ttl=128 (reply in 13)
13	9.115057	143.89.209.9	10.98.0.3	ICMP	60	Echo (ping) reply    id=0x0001, seq=34/8704, ttl=36 (request in 12)
14	9.879613	10.98.0.3	143.89.209.9	ICMP	60	Echo (ping) request  id=0x0001, seq=35/8960, ttl=128 (reply in 15)
15	10.128566	143.89.209.9	10.98.0.3	ICMP	60	Echo (ping) reply    id=0x0001, seq=35/8960, ttl=36 (request in 14)
16	10.884715	10.98.0.3	143.89.209.9	ICMP	60	Echo (ping) request  id=0x0001, seq=36/9216, ttl=128 (reply in 17)
17	11.123888	143.89.209.9	10.98.0.3	ICMP	60	Echo (ping) reply    id=0x0001, seq=36/9216, ttl=36 (request in 16)
18	11.888296	10.98.0.3	143.89.209.9	ICMP	60	Echo (ping) request  id=0x0001, seq=37/9472, ttl=128 (reply in 19)
19	12.127259	143.89.209.9	10.98.0.3	ICMP	60	Echo (ping) reply    id=0x0001, seq=37/9472, ttl=36 (request in 18)
20	12.892389	10.98.0.3	143.89.209.9	ICMP	60	Echo (ping) request  id=0x0001, seq=38/9728, ttl=128 (reply in 21)
21	13.132055	143.89.209.9	10.98.0.3	ICMP	60	Echo (ping) reply    id=0x0001, seq=38/9728, ttl=36 (request in 20)
22	13.896425	10.98.0.3	143.89.209.9	ICMP	60	Echo (ping) request  id=0x0001, seq=39/9984, ttl=128 (reply in 23)
23	14.135413	143.89.209.9	10.98.0.3	ICMP	60	Echo (ping) reply    id=0x0001, seq=39/9984, ttl=36 (request in 22)
24	14.900055	10.98.0.3	143.89.209.9	ICMP	60	Echo (ping) request  id=0x0001, seq=40/10240, ttl=128 (reply in 25)
25	15.142552	143.89.209.9	10.98.0.3	ICMP	60	Echo (ping) reply    id=0x0001, seq=40/10240, ttl=36 (request in 24)
```

<img width="1063" height="664" alt="image" src="https://github.com/user-attachments/assets/10e422a6-7121-4b99-9a33-fd255f4e1149" />

- Host IP address: `10.98.0.3`
- Destination IP address: `143.89.209.9`
- ICMP doesn't use source or destination ports because it is a layer 3 protocol.  Ports are a Layer 4 feature used by TCP and UDP to identify applications.
- ICMP type: `Echo (ping) request (8)`

      Type: Echo (ping) request (8)

- ICMP code: `0`
- Other fields:

```
6	5.863306	10.98.0.3	143.89.209.9	ICMP	60	Echo (ping) request  id=0x0001, seq=31/7936, ttl=128 (reply in 7)

Internet Control Message Protocol
    Checksum: 0x4d3c [correct]
    [Checksum Status: Good]
    Identifier (BE): 1 (0x0001)
    Identifier (LE): 256 (0x0100)
    Sequence Number (BE): 31 (0x001f)
    Sequence Number (LE): 7936 (0x1f00)
    [Response frame: 7]
    Data (32 bytes)
```

- Size (bytes) of **checksum**, **sequence number**, and **identifier**?
	- Checksum: 19,772 bytes after converting `0x4d3c` into decimal
	- Sequence number: 31 bytes
	- Identifier: 1 byte

```
ping -n 10 www.ust.hk

Pinging www.ust.hk [143.89.209.9] with 32 bytes of data:
Reply from 143.89.209.9: bytes=32 time=238ms TTL=36
Reply from 143.89.209.9: bytes=32 time=239ms TTL=36
Reply from 143.89.209.9: bytes=32 time=239ms TTL=36
Reply from 143.89.209.9: bytes=32 time=239ms TTL=36
Reply from 143.89.209.9: bytes=32 time=249ms TTL=36
Reply from 143.89.209.9: bytes=32 time=239ms TTL=36
Reply from 143.89.209.9: bytes=32 time=239ms TTL=36
Reply from 143.89.209.9: bytes=32 time=239ms TTL=36
Reply from 143.89.209.9: bytes=32 time=239ms TTL=36
Reply from 143.89.209.9: bytes=32 time=242ms TTL=36

Ping statistics for 143.89.209.9:
    Packets: Sent = 10, Received = 10, Lost = 0 (0% loss),
Approximate round trip times in milli-seconds:
    Minimum = 238ms, Maximum = 249ms, Average = 240ms
```

---

## Part 2: ICMP and Traceroute

### Instructions
1. Open **Windows Command Prompt**.
2. Start **Wireshark** and begin packet capture.
3. Run the Traceroute command:  
```cmd
tracert hostname
```

- Use a host on **another continent** (e.g., `www.inria.fr` if outside Europe).

```cmd
tracert www.inria.fr
```
		
4. Press **Enter** to execute.
5. When Traceroute terminates, **stop Wireshark capture**.

---

### Questions to Answer

| # | Question |
|---|---------|
| 5 | What is the **IP address of your host**? What is the **IP address of the target destination**? |
| 6 | If ICMP sent **UDP packets** (like Unix/Linux), would the **IP protocol number** still be **01**? If not, what would it be? |
| 7 | Examine an **ICMP echo packet** in Traceroute. Is it **different** from Ping query packets? **How**? |
| 8 | Examine an **ICMP error packet**. It has **more fields** than echo packets. **What is included** in those fields? |
| 9 | Examine the **last three ICMP packets** received. How are they **different** from ICMP error packets? **Why**? |
| 10 | In `tracert` output:  
  • Is there a **link with significantly higher delay**?  
  • Refer to Figure 4: Identify the **high-delay link**.  
  • Using **router names**, guess the **location** of the two routers at its ends. |

---

## Part 3: Extra Credit

### Task
Use your **UDP client ping program** (from programming assignment):

1. Send a **UDP packet** with an **unusual destination port** to a **live host**.
2. Use **Wireshark** to capture the **response**.
3. Provide:
   - **Wireshark screenshot** of the response
   - **Analysis** of the response packet

---

## Submission Checklist

| Item | Required |
|------|----------|
| Command Prompt screenshot (Ping) | Yes |
| Command Prompt screenshot (Traceroute) | Yes |
| Annotated Wireshark printouts (all relevant packets) | Yes |
| Answers to **Questions 1–10** | Yes |
| Extra Credit: UDP response screenshot + analysis | Optional |

---

## What I Learned

